 <html>
<script src="../math.js"></script>
<script src="../shape.js"></script>
<script src="../webgl.js"></script>
<script src="../render.js"></script>

<script src="controler.js"></script>
<script>
'use strict';
var gl$ = function (obj){
	return document.getElementById(obj).getContext("experimental-webgl");
}
var loop$ = function (call){
	window.requestAnimationFrame(call);
}
function start(){
	var scene = new Scene();
	var gnd = new Geom4(Mesh4.cuboid(30,2,30,30)).move(new Vec4(0,-0.5002,0,0));
	scene.add(gnd);
	
	var slops = new Chunk4(8,8,16,8);
	//slops:
	slops.set(-1, 3,1,3,3);
	slops.set(-2, 1,1,3,3);
	slops.set(-3, 2,1,13,3);
	slops.set(-4, 2,1,2,3);
	slops.set(-5, 2,1,3,4);
	slops.set(-6, 2,1,3,2);
	//mat:
	slops.setCuboid(3, 0,0,3,3, 4,0,3,3);
	slops.set(3, 2,0,1,3);
	slops.setCuboid(3, 2,0,3,1, 2,0,3,5);
	
	//tunel:
	slops.setCuboid(5, 1,1,5,2, 3,3,11,4);
	slops.setCuboid(0, 2,2,5,3, 2,2,11,3);
	
	//platform:
	slops.setCuboid(1, 2,1,3,3, 2,1,12,3);
	
	scene.add(new Geom4(slops.generateMesh().weld()));
	
	var camera = new Camera4(120,0.01,30);
	camera.position = new Vec4(2,4,2,2);
	var renderer = new Renderer4(gl$("glCanvas1"),gl$("glCanvas2"),scene,camera,new Vec4(1.4,1,2.2,1.7));
	
	var controler = new Controler4.KeepUp(renderer,(pos)=>((pos.y>0.5)?slops.hitTest(pos):true));
	controler.gravity = true;
	
	function loop(){
		controler.update(renderer.render.bind(renderer));
		loop$(loop);
	}
	loop();
}
</script>
<body onload="start()">
<canvas id="glCanvas1" width="800" height="800" style="background-color:#000"></canvas>
<canvas id="glCanvas2" width="800" height="800" style="background-color:#000"></canvas>
<!--bug: bgColor must be 000 because of alpha transparency-->
</body>
</html>